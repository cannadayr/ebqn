#! /usr/bin/env dbqn
argsâ†â€¢args
return â† 1â‰¡âŠ‘args
argsâ†“Ëœâ†© return
"call with argument specifying path of mlochbaum/BQN!"!2â‰¤â‰ args
pathâ†(âŠ‘args)âˆ¾"/src/"
argsâ†“Ëœâ†©1

# Javascript/JSON formatting
L â† "["âˆ¾"]"âˆ¾Ëœ1â†“Â·âˆ¾","âŠ¸âˆ¾Â¨       # Native list/array
Ind â† {âˆ¾"ebqn_array:get("â€¿ğ•©â€¿","â€¿ğ•¨â€¿")"}          # Native list/array indexing
Cat â† {âˆ¾ğ•¨â€¿"lists:append(ebqn_core:fns(),"â€¿ğ•©â€¿")"}   # Native list/array concatenation (like âˆ¾)
# Escape the special characters that appear in BQN sources.
Escâ†{
  in â† (@+0â€¿9â€¿10â€¿13)âˆ¾"'"""    # Null, Tab, LF, CR, and quotes
  out â† "0tnr"                # Whitespace characters changed to letters
  i â† inâŠğ•©
  ğ•© â†© i âŠâŸœoutâŒ¾((i<â‰ out)âŠ¸/) ğ•©  # Replace
  âˆ¾(i<â‰ in) /âŸœ"\"âŠ¸âˆ¾Â¨ ğ•©         # Insert \
}
Str â† "ebqn:str("""âˆ¾Escâˆ¾""")"Ëœ       # A BQN string
Char â† {"ebqn:char("""âˆ¾ğ•©âˆ¾""")"}Escâˆ˜â¥Š # A BQN character
FP â† âˆâŠ¸=â—¶âŸ¨â•,"inf"âŸ©              # Format positive number
Num0 â† 0âŠ¸â‰¤â—¶âŸ¨"-"âˆ¾FPâˆ˜|,FPâŸ©        # Format number
Num â† Â¯âˆâŠ¸â‰¢â—¶âŸ¨"n"âˆ¾Num0âˆ˜|,Num0âŸ©

F â† â•  # Format number

Import â† â€¢Import pathâŠ¸âˆ¾
compile â† Import "c.bqn"
useInd â† "-i"â‰¡âŠ‘args â‹„ argsâ†“Ëœâ†©useInd
Comp â† (3+useInd) â†‘ ((<"Rt#a.r" Ind â•)Â¨â†•62)âŠ¸Compile
J â† âˆ¾âˆ¾âŸœ(@+10)Â¨
Fconst â† â‰¡â—¶âŸ¨@âŠ¸â‰¤â—¶Numâ€¿Char, Str, âŠ‘âŸ©
Fout â† (â‰ â†‘âŸ¨F,Fconst,L FÂ¨,FâŸ©Ë™) {Lğ•Â¨ğ•©}Â¨ âŠ¢
Frun â† ""âŠ¸CatâŒ¾(1âŠ¸âŠ‘) Fout
Long â† âˆ¾ (â‰ â†‘1â€¿3/âŸ¨"  "âŠ¸âˆ¾â‹„((@+10)âˆ¾" ,")âŠ¸âˆ¾âŸ©Ë™) {ğ•ğ•©}Â¨ âŠ¢
â€¢OutâŸ(Â¬return) (âŠ‘"r"â€¿"c"â€¿"f"â€¿"e"âŠâŠ)â—¶âŸ¨
  {ğ•©â‹„refâ€¿lenâ†Import"pr.bqn"â‹„Long Frun lenâŠ¸â†“âŒ¾(1âŠ¸âŠ‘)Comp ref}
  {ğ•©â‹„Long Fout Comp â€¢FChars "c.bqn"}
  {ğ•©â‹„Long Fout Comp â€¢FChars "f.bqn"}
  {ğ•©â‹„Long Fout Comp âŸ¨"Modifyâ†GetHighlightsâ†âŠ¢â‹„"âŸ©âˆ¾âˆ¾ â€¢FCharsâˆ˜âˆ¾âŸœ".bqn"Â¨ "../svg"â€¿"e"}
  Â¯1 â†“ Â· J Lâˆ˜Foutâˆ˜CompÂ¨
âŸ© args
